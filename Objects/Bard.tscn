[gd_scene format=3 uid="uid://cieemcbemdyu1"]

[ext_resource type="Script" uid="uid://ctjb1eughues3" path="res://Scripts/PlayerRef.cs" id="1_6cr34"]
[ext_resource type="Script" uid="uid://dsxgn7ujeotov" path="res://Scripts/MovementModule.cs" id="2_hj2n3"]
[ext_resource type="SpriteFrames" uid="uid://0pwfb2bexl30" path="res://Sprites/chara_sprite_frame.tres" id="2_vycds"]
[ext_resource type="Texture2D" uid="uid://g3fccqaeycpr" path="res://Sprites/S_Character_002.png" id="3_efr62"]
[ext_resource type="SpriteFrames" uid="uid://cu0xntdpb5j1j" path="res://Sprites/Trumpet.tres" id="3_f4fd3"]
[ext_resource type="Script" uid="uid://x2fqao1t4e3d" path="res://Scripts/ShooterModule.cs" id="3_j35rj"]
[ext_resource type="Texture2D" uid="uid://qpjeyq56y2oy" path="res://Sprites/S_Character.png" id="4_pv0n8"]
[ext_resource type="Script" uid="uid://idi63dk6617h" path="res://Scripts/DeathModule.cs" id="6_vycds"]
[ext_resource type="Script" uid="uid://jabjt1w4hat0" path="res://Scripts/ScoreModule.cs" id="7_m75ex"]
[ext_resource type="PackedScene" uid="uid://btxcu3ocmec0l" path="res://Objects/Mask/Top/SizeManagementTop.tscn" id="8_gu161"]
[ext_resource type="PackedScene" uid="uid://cbx0wa83ttvbq" path="res://Objects/Mask/Top/TopInverseControl.tscn" id="8_wuptk"]
[ext_resource type="Script" uid="uid://rchpu5klj7ae" path="res://Scripts/MaskManagerModule.cs" id="9_gu161"]
[ext_resource type="PackedScene" uid="uid://bkvuqgwl3d6v7" path="res://Objects/Mask/Bot/RecoilMask.tscn" id="9_ipvlt"]
[ext_resource type="PackedScene" uid="uid://bqr78pjypam2t" path="res://Objects/Mask/Bot/HeavyMask.tscn" id="10_gncx5"]
[ext_resource type="PackedScene" uid="uid://duegd7sb1lahr" path="res://Objects/Mask/Top/TopCanShootAndMove.tscn" id="10_wuptk"]
[ext_resource type="PackedScene" uid="uid://daorbttk3cicv" path="res://Objects/Mask/Bot/BouncingMask.tscn" id="11_f4fd3"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_j7ih7"]
size = Vector2(256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_maamg"]
atlas = ExtResource("3_efr62")
region = Rect2(0, 0, 256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_1xibd"]
atlas = ExtResource("3_efr62")
region = Rect2(256, 0, 256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_dptvt"]
atlas = ExtResource("3_efr62")
region = Rect2(512, 0, 256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_vh5un"]
atlas = ExtResource("3_efr62")
region = Rect2(0, 256, 256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_tx3me"]
atlas = ExtResource("3_efr62")
region = Rect2(256, 256, 256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_rwejx"]
atlas = ExtResource("3_efr62")
region = Rect2(512, 256, 256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_7m3il"]
atlas = ExtResource("4_pv0n8")
region = Rect2(0, 0, 256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_n85p8"]
atlas = ExtResource("4_pv0n8")
region = Rect2(256, 0, 256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_g67vh"]
atlas = ExtResource("4_pv0n8")
region = Rect2(512, 0, 256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_4scbk"]
atlas = ExtResource("4_pv0n8")
region = Rect2(0, 256, 256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_u143s"]
atlas = ExtResource("4_pv0n8")
region = Rect2(256, 256, 256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_ty8tm"]
atlas = ExtResource("4_pv0n8")
region = Rect2(512, 256, 256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_pmrbn"]
atlas = ExtResource("4_pv0n8")
region = Rect2(0, 512, 256, 256)

[sub_resource type="AtlasTexture" id="AtlasTexture_uk4rk"]
atlas = ExtResource("4_pv0n8")
region = Rect2(256, 512, 256, 256)

[sub_resource type="SpriteFrames" id="SpriteFrames_wkj15"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_maamg")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_1xibd")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_dptvt")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_vh5un")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_tx3me")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_rwejx")
}],
"loop": true,
"name": &"Iddle",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_7m3il")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_n85p8")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_g67vh")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4scbk")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_u143s")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ty8tm")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_pmrbn")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_uk4rk")
}],
"loop": true,
"name": &"Walk",
"speed": 5.0
}]

[sub_resource type="LabelSettings" id="LabelSettings_l63ou"]
font_size = 46

[node name="Bard" type="CharacterBody2D" unique_id=646171583 node_paths=PackedStringArray("_scallable", "_as")]
process_priority = 1
script = ExtResource("1_6cr34")
_scallable = [NodePath("CollisionShape2D"), NodePath("Scaler")]
_frames = ExtResource("2_vycds")
_as = NodePath("Scaler/AnimatedSprite2D")

[node name="CollisionShape2D" type="CollisionShape2D" parent="." unique_id=1916308384]
shape = SubResource("RectangleShape2D_j7ih7")

[node name="Scaler" type="Node2D" parent="." unique_id=2080904182]

[node name="BotSpawnPoint" type="Node2D" parent="Scaler" unique_id=2031523579]
position = Vector2(64, -64)
scale = Vector2(1.5, 1.5)

[node name="TopSpawnPoint" type="Node2D" parent="Scaler" unique_id=1411852043]
position = Vector2(64, -64)
scale = Vector2(1.5, 1.5)

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="Scaler" unique_id=210915665]
sprite_frames = SubResource("SpriteFrames_wkj15")
animation = &"Iddle"

[node name="Node2D" type="Node2D" parent="." unique_id=449125132]

[node name="Trumpet" type="AnimatedSprite2D" parent="Node2D" unique_id=562335248]
position = Vector2(-6.465939e-13, -206)
rotation = 3.1415927
scale = Vector2(0.6, 0.6)
sprite_frames = ExtResource("3_f4fd3")
animation = &"Shoot"

[node name="CannonPoint" type="Node2D" parent="Node2D/Trumpet" unique_id=805856140]
position = Vector2(9.991174e-06, 114.285706)

[node name="Label" type="Label" parent="." unique_id=1580218230]
offset_left = -116.0
offset_top = -134.0
offset_right = -63.0
offset_bottom = -70.0
text = "00"
label_settings = SubResource("LabelSettings_l63ou")

[node name="ShootReset" type="Timer" parent="." unique_id=571089655]

[node name="MovementModule" type="Node" parent="." unique_id=404004772 node_paths=PackedStringArray("_canonRotator")]
script = ExtResource("2_hj2n3")
_canonRotator = NodePath("../Node2D")
Speed = 150.0

[node name="ShooterModule" type="Node" parent="." unique_id=392662035 node_paths=PackedStringArray("_shootTimer", "_canon")]
script = ExtResource("3_j35rj")
_shootTimer = NodePath("../ShootReset")
_canon = NodePath("../Node2D/Trumpet/CannonPoint")

[node name="DeathModule" type="Node" parent="." unique_id=1671506929]
script = ExtResource("6_vycds")

[node name="MaskManagerModule" type="Node" parent="." unique_id=1544661391 node_paths=PackedStringArray("_topPos", "_botPos")]
process_priority = 1
script = ExtResource("9_gu161")
_topMasks = Array[PackedScene]([ExtResource("8_gu161"), ExtResource("8_wuptk"), ExtResource("10_wuptk")])
_botMasks = Array[PackedScene]([ExtResource("9_ipvlt"), ExtResource("11_f4fd3"), ExtResource("10_gncx5")])
_topPos = NodePath("../Scaler/BotSpawnPoint")
_botPos = NodePath("../Scaler/TopSpawnPoint")

[node name="ScoreModule" type="Node" parent="." unique_id=1318049100]
script = ExtResource("7_m75ex")

[node name="MaskSpawnTimer" type="Timer" parent="." unique_id=1184467307]
wait_time = 0.5
one_shot = true
autostart = true

[connection signal="animation_finished" from="Node2D/Trumpet" to="ShooterModule" method="CreateBullet"]
[connection signal="timeout" from="ShootReset" to="ShooterModule" method="ResetShoot"]
[connection signal="Flip" from="MovementModule" to="Scaler/AnimatedSprite2D" method="set_flip_h"]
[connection signal="Flip" from="MovementModule" to="MaskManagerModule" method="MaskFlip"]
[connection signal="Iddle" from="MovementModule" to="Scaler/AnimatedSprite2D" method="play" binds= ["Iddle"]]
[connection signal="Walking" from="MovementModule" to="Scaler/AnimatedSprite2D" method="play" binds= ["Walking"]]
[connection signal="OnShoot" from="ShooterModule" to="Node2D/Trumpet" method="play"]
[connection signal="OnDeath" from="DeathModule" to="Scaler/BotSpawnPoint" method="set_visible" binds= [false]]
[connection signal="OnDeath" from="DeathModule" to="Scaler/TopSpawnPoint" method="set_visible" binds= [false]]
[connection signal="OnDeath" from="DeathModule" to="Scaler/AnimatedSprite2D" method="play" binds= ["Lose"]]
[connection signal="ChangeScore" from="ScoreModule" to="Label" method="set_text"]
[connection signal="OnVictory" from="ScoreModule" to="Scaler/AnimatedSprite2D" method="play" binds= ["Win"]]
[connection signal="timeout" from="MaskSpawnTimer" to="MaskManagerModule" method="GenerateMasks"]
[connection signal="timeout" from="MaskSpawnTimer" to="." method="SetPause" binds= [false]]
